version: 1.0.{build}
# Test against the latest version of this Node.js version
environment:
  nodejs_version: "10"
  npm_auth_token:
    secure: EMAG/RBf64HYn+zMLR9NmZM9ZP6RJlQCblOYOhMn+9geT9k7imsqmc6qfmoBLodM

build:
  verbosity: minimal

branches:
  only:
    - master
    - '/v[0-9]+(\.[0-9]+)*/'

# Install scripts. (runs after repo cloning)
install:
  # Get the latest stable version of Node.js or io.js
  - ps: Install-Product node $env:nodejs_version
  # install modules
  # - npm install
  - yarn install --frozen-lockfile

build_script:
  - npm version %APPVEYOR_BUILD_VERSION% -m 'v%APPVEYOR_BUILD_VERSION%'
  - yarn run build

test_script:
  - yarn test

cache:
  - node_modules
  - '%LOCALAPPDATA%/Yarn'

# deploy:
#   - ps: '"//registry.npmjs.org/:_authToken=$env:npm_auth_token`n" | out-file "$env:userprofile\.npmrc" -Encoding ASCII'

# Don't actually build.
# build: off